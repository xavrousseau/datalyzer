/* ============================================================================
   DATALYZER — Thème Streamlit (sombre par défaut, clair via prefers-color-scheme)
   Objectif : UI sobre, zen, lisible. Robuste aux changements de classes Streamlit.
   ----------------------------------------------------------------------------
   Plan :
   1) Variables & base (dark)
   2) Layout responsive (largeur max / gouttières)
   3) Composants (inputs, boutons, cartes, onglets, etc.)
   4) Mode clair (overrides fiables)
   5) Patches de robustesse (sélecteurs stables, a11y)
============================================================================ */

/* ========== 1) VARIABLES & BASE (DARK) ==================================== */
:root{
  /* Palette sombre */
  --bg:       #0D0E17;
  --panel:    #1A1B2B;
  --sidebar:  #141625;
  --text:     #E7EAF0;
  --muted:    #A7B0C0;
  --line:     #2A2C3D;
  --accent:   #6C9DD8;  /* bleu doux */
  --accent-2: #FF6D99;  /* rose sakura (H1 / éléments d’accent) */
  --accent-3: #88BDBC;  /* vert bambou (H3) */

  /* Mise en page */
  --page-max: 1280px;
  --gutter:   1.25rem;
}

/* Corps global (police + couleurs de base) */
html, body{
  font-family: 'Noto Sans JP', system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  font-size: 16px;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}

/* Sidebar (texture douce, non agressive) */
section[data-testid="stSidebar"]{
  background-color: var(--sidebar);
  background-image: url("https://www.transparenttextures.com/patterns/wavecut.png");
  background-size: 180px;
  background-repeat: repeat;
  background-blend-mode: overlay;
}

/* Titres (fonctions d’accent) */
h1 { font-size: 2rem;   font-weight: 700; color: var(--accent-2); }
h2 { font-size: 1.6rem; font-weight: 600; color: color-mix(in srgb, var(--accent-2) 75%, white 25%); }
h3 { font-size: 1.3rem; font-weight: 600; color: var(--accent-3); }

/* Longueur de ligne lisible pour les textes */
p, .lead, .card .text { max-width: 72ch; }

/* ========== 2) LAYOUT RESPONSIVE ========================================== */
/* Conteneur principal Streamlit (sélecteur stable) */
[data-testid="stAppViewContainer"] .block-container{
  width: 100%;
  max-width: var(--page-max);
  padding-left: var(--gutter);
  padding-right: var(--gutter);
}

/* Plafonds progressifs pour très grands écrans */
@media (min-width:1600px){ :root{ --page-max: 1440px; } }
@media (min-width:1900px){ :root{ --page-max: 1600px; } }

/* Wrappers génériques si utilisés */
.wrapper, .content, .inner{
  width: 100%;
  max-width: var(--page-max);
  margin-inline: auto;
  padding-inline: var(--gutter);
}

/* ========== 3) COMPOSANTS (DARK) ========================================== */
/* Inputs / selects / textareas */
input, select, textarea,
.stTextInput input, .stNumberInput input, .stDateInput input,
.stSelectbox div[role="combobox"] input{
  background-color: #1A1C2B;
  color: var(--text);
  border-radius: 8px;
  border: 1px solid #333;
  outline: none;
}

/* Placeholders lisibles en sombre */
input::placeholder, textarea::placeholder{
  color: color-mix(in srgb, var(--text) 60%, transparent);
}

/* Boutons */
.stButton > button, button{
  background-color: var(--accent);
  color: #fff;
  border-radius: 8px;
  padding: .5rem 1rem;
  font-size: 14px;
  border: none;
  cursor: pointer;
  transition: background-color .2s ease-in-out, transform .05s ease-in-out;
}
.stButton > button:hover, button:hover{ background-color: #547BB3; }
.stButton > button:active, button:active{ transform: translateY(1px); }

/* Cartes / blocs */
div[data-testid="stVerticalBlock"]{
  background-color: var(--panel);
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,.3);
  padding: 1.25rem;
  margin-bottom: 1.25rem;
}

/* Scrollbar (WebKit) */
::-webkit-scrollbar{ width: 10px; }
::-webkit-scrollbar-thumb{ background-color: #3A3A4D; border-radius: 6px; }

/* Onglets */
.stTabs [role="tablist"]{ border-bottom: 2px solid var(--line); }
.stTabs [role="tab"]{
  color: var(--accent-2);
  padding: .5rem 1rem;
  font-weight: 600;
  opacity: .9;
}
.stTabs [aria-selected="true"]{
  border-bottom: 3px solid var(--accent);
  color: var(--accent);
  opacity: 1;
}

/* Expanders (balise <details>) */
details{
  background-color: #1F2030;
  border: 1px solid #333;
  border-radius: 8px;
  padding: .8rem;
}

/* Messages / alertes */
.stAlert{
  border-radius: 8px;
  padding: 1rem;
  box-shadow: none;
}

/* Pied Streamlit (sélecteur stable) */
[data-testid="stFooter"]{ display: none; }

/* ========== 4) MODE CLAIR (OVERRIDES) ===================================== */
/* Active automatiquement si l’OS/navigateur est en “light”. */
@media (prefers-color-scheme: light){
  :root{
    --bg:       #F6F7FB;
    --panel:    #FFFFFF;
    --sidebar:  #EEF1F7;
    --text:     #0F172A;
    --muted:    #334155; /* légèrement plus contrasté pour la lisibilité */
    --line:     #D5D8E2;
    --accent:   #6C9DD8;
    --accent-2: #FF6D99;
    --accent-3: #2B6C6B;
  }

  html, body{ background: var(--bg); color: var(--text); }

  section[data-testid="stSidebar"]{
    background: var(--sidebar);
    background-image: none;
  }

  /* Titres */
  h1{ color: var(--accent-2); }
  h2{ color: color-mix(in srgb, var(--accent-2) 75%, white 25%); }
  h3{ color: var(--accent-3); }

  /* Texte courant (renfort) */
  [data-testid="stAppViewContainer"],
  [data-testid="stMain"],
  [data-testid="stMarkdownContainer"]{
    color: var(--text);
  }
  [data-testid="stMarkdownContainer"] p,
  [data-testid="stMarkdownContainer"] li,
  [data-testid="stMarkdownContainer"] strong,
  [data-testid="stMarkdownContainer"] em{
    color: var(--text);
  }

  /* Inputs */
  input, select, textarea,
  .stTextInput input, .stNumberInput input, .stDateInput input,
  .stSelectbox div[role="combobox"] input{
    background-color: var(--panel);
    color: var(--text);
    border-color: var(--line);
  }
  input::placeholder, textarea::placeholder{
    color: color-mix(in srgb, var(--text) 60%, transparent);
  }

  /* Boutons */
  .stButton > button, button{
    background-color: var(--accent);
    color: #fff;
  }
  .stButton > button:hover, button:hover{ background-color: #3b82c4; }

  /* Cartes / blocs */
  div[data-testid="stVerticalBlock"]{
    background-color: var(--panel);
    border-color: var(--line);
    box-shadow: 0 1px 3px rgba(0,0,0,.08);
  }

  /* Tabs */
  .stTabs [role="tablist"]{ border-bottom: 1px solid var(--line); }
  .stTabs [role="tab"]{ color: var(--accent-2); }
  .stTabs [aria-selected="true"]{
    border-bottom: 3px solid var(--accent);
    color: var(--accent);
  }

  /* Légendes / muted */
  .muted, .caption, small, .stCaption{
    color: var(--muted);
    opacity: 1;
  }

  /* Séparateurs */
  hr, .stDivider{ border-color: var(--line); color: var(--line); }

  /* Progress bar */
  .stProgress [role="progressbar"] > div{ background-color: var(--accent); }
  .stProgress > div{ background-color: #e5e7eb; }

  /* File uploader */
  .stFileUploader,
  .stFileUploader > section,
  .stFileUploader div[data-testid="stFileUploaderDropzone"]{
    background: var(--panel);
    border-color: var(--line);
    color: var(--text);
  }

  /* Liens */
  a, a:visited{ color: #0b66c3; }
  a:hover{ color: #074a91; }
}

/* ========== 5) PATCHES DE ROBUSTESSE ====================================== */
/* Héritage cohérent du texte : évite le “gris clair sur blanc” en clair */
[data-testid="stAppViewContainer"] *{ color: inherit; }

/* Fond du conteneur racine (au cas où Streamlit surécrit html/body) */
[data-testid="stAppViewContainer"]{ background: inherit; }

/* Focus visible (A11Y) — correction du sélecteur : pas d’espace avant :focus */
:where(input, select, textarea, button, [role="combobox"]):focus{
  outline: 2px solid #94a3b8;
  outline-offset: 2px;
  box-shadow: none;
}

/* Images responsives (bannières, logos) */
img{ max-width: 100%; height: auto; }

/* Header Streamlit transparent */
[data-testid="stHeader"]{ background: transparent; }
